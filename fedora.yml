---
- hosts: localhost
  gather_facts: no
  tasks:
  - name: change hostname to lenovo-330
    become: true
    hostname:
      name: lenovo-330

  - name: Add the RPM Fusion free repo
    become: true
    dnf:
      state: present
      name: '{{ rpmfusion_free_url }}'

  - name: Remove unneeded packages
    become: true
    dnf:
      state: absent
      name: ['virtualbox-guest-additions', 'fedora-release-notes', 'abrt',
             'gnome-boxes', 'totem', 'rhythmbox', 'firefox', 'cheese',
             'libreoffice-core', 'gnome-weather']

  - name: Upgrade the system
    become: true
    dnf:
      state: latest
      name: '*'
  
  - name: Enable my sway copr
    become: true
    command: "dnf copr enable -y geext/sway"
    args:
        creates: /etc/yum.repos.d/_copr:copr.fedorainfracloud.org:geext:sway.repo
  
  - name: Enable kitty-latest copr
    become: true
    command: "dnf copr enable -y gagbo/kitty-latest"
    args:
        creates: /etc/yum.repos.d/_copr:copr.fedorainfracloud.org:gagbo:kitty-latest.repo
  
  - name: Enable kitty-latest copr
    become: true
    command: "dnf copr enable -y alebastr/waybar"
    args:
        creates: /etc/yum.repos.d/_copr:copr.fedorainfracloud.org:alebastr:waybar.repo

  - name: Install system packages
    become: true
    dnf:
      state: present
      name: ['google-noto-sans-fonts',
             'neovim',
             'gcc-c++',
             'gdb',
             'cmake',
             'ninja-build',
             'make',
             'meson',
             'flatpak',
             'git',
             'podman',
             'buildah',
             'zram',
             'kitty',
             'sway',
             'waybar',
             'light',
             'mpd',
             'swaybg',
             'playerctl',
             '{{ windscribe_rpm }}',
             '{{ google_chrome_rpm }}',

             # For building RPM packages
             'rpm-build',
             'rpm-devel',
             'rpmlint',
             'coreutils',
             'diffutils',
             'rpmdevtools'
             ]

  - name: Enable systemd services
    become: true
    systemd:
      enabled: true
      name: zram-swap.service

# flatpak module is currently broken
  - import_tasks: tasks/flatpak.yml

